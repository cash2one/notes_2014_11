* 问题搜集
** Reduce失败，提示：java.lang.NullPointerException
我用Python写了一个MapReduce脚本，但是在reduce阶段，任务总是失败。失败
信息如下：
#+BEGIN_SRC java
java.lang.NullPointerException
	at org.apache.hadoop.streaming.PipeMapRed.getContext(PipeMapRed.java:744)
	at org.apache.hadoop.streaming.PipeMapRed.logFailure(PipeMapRed.java:775)
	at org.apache.hadoop.streaming.PipeReducer.reduce(PipeReducer.java:133)
	at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:816)
	at org.apache.hadoop.mapred.Child.main(Child.java:212)
#+END_SRC

一开始，错误信息看不出头绪，我以为我使用的集群（百度内部的IDLE集群，用
公司的空闲资源来提供高量低质的计算力的集群）不行，准备借一个其他好点的
集群的队列。亏好我多点了几下，进入到任务的stderr页面，在最下面看到了如
下信息：
#+BEGIN_SRC python
Traceback (most recent call last):
  File "/home/disk6/infidle/local/normal/job_20140321151543_439979-vertex1-reduce_20140430062926-1072/appSlave/job_20140321151543_439979/attempt_20140321151543_439979_r001_000000_1002/work/./merge_pid.py", line 4, in ?
    from operator import itemgetter
ImportError: cannot import name itemgetter
#+END_SRC

这样，reduce失败的原因就很明显了，是集群的Python版本太低，没有内置
itemgetter模块导致的。这么是我的reducer脚本。
#+BEGIN_SRC python
from operator import itemgetter

pid_counts = {}
...
...
for pid, count in sorted(pid_counts.items(), key=itemgetter(1), reverse=True):
  print "pid:", pid, count
#+END_SRC

我修改了一下，不用itemgetter和sorted实现排序，而是只用用dict的原生遍历
方法来输出reduce结果后，问题解决。
#+BEGIN_SRC python
for pid in pid_counts:
  print pid, pid_counts[pid]
#+END_SRC
