#+TITLE: Logagent用户手册
#+DATE: 2014-04-03

* Logagent简介
Logagent是一个调用Bigpipe API向Bigpipe发布单机上的日志文件的程序。

Logagent是Bigpipe的一个用户，所以说， *日志文件发布* 以外的问题，请咨询Bigpipe的
同学 [[http://bp.baidu.com/]] ，而不是问 *仲毅* 。

使用测试版Logagent做线下发布测试

* 使用测试版Logagent
** 如何配置？
#+BEGIN_SRC python
[@multi_datasource]                                       
                                             
# 你的日志目录？
datasource : /home/work/pb/log/                                                                        
                                                                                                       
# 你的日志名字的正则表达式？
file_name_prefix : ^test\.log\.\d{8}\d{2}\d{2}$|^test\.log$                                            
                                                                                                       
# 从哪个文件开发发布？如果不设且进度文件为空，则从最新的开始发。
start_file_name : click_log.20110810120005                                                             
                                                                                                       
# 是否要传输b2log日志？0表示普通的文本日志，1表示b2log日志（Protobuf格式）
open_binary : 0                                                                                        
binary_read_lib_path : ./lib/libcodexapi.so                                                            
                                                                                                       
# 发布到哪个Bigpipe集群，哪个pipe，token是多少？（请咨询Bigpipe的同学）
meta_host : 10.213.103.27:2181,10.213.103.30:2182,10.213.103.25:2183                                
root_path : /bigpipe_sandbox  
pipename :  nova-cmui-default-sdb                                                                      
token : nova-PUB                                                                                       
                                                                                                       
# 发布进度保存在哪个目录？不同的日志源的目录务必不能重复！
bmq_persist_path: ./persist_path           
#+END_SRC


* 测试版Logagent的异常处理
** FATAL
这是老版Logagent在使用公司Configure库时再配置文件里面配了 *[@* 导致的，不用管它。

* 线上版Logagent的异常处理
** 如何重启线上Logagent？
（首先得要有节点的OP权限）点击 *数据管理平台* -> *日志查看修改* ，找到你的日志下
载。

[[./img/logagent-manual-1.png]]

然后点击 *基本操作* 进入到 *下载任务* 页面。

[[./img/logagent-manual-2.png]]

在 *下载任务* 页面，选中想要重启的机器，再点击 *批量重启* 。即可实现批量重启。

[[./img/logagent-manual-3.png]]

* FAQ
*Q:* 我们的日志路径是这样的 /home/work/xxx/20140403/warning.log，那该配置Logagent的日
志目录和名称呢？

*A:* Logagent支持递归扫子目录。假设你的切割方式是：每天的日志切割到以当天日期命名的子
目录里，并以warning.log为名字，则可以这样配置：

[[./img/logagent-manual-4.png]]

Q：一个Logagent支持同时发布两个日志源码？

A：不支持！一个Logagent不能通知追踪发布两个日志源，这样会导致发布错乱，数据重复等
严重问题。如果有两个发布源要发布到同一个pipename里面，则需要在找OP审核时明确地告
诉OP第二个发布源发布到第一个发布源的pipename里面。


* 订阅失败

* 参考链接
经典版Logagent产品库地址：
#+BEGIN_SRC 
scp -r getprod@product.scm.baidu.com:/data/prod-64/inf/bigpipe/pub/pub_1-0-13-1_PD_BL .
#+END_SRC

[[http://wiki.babel.baidu.com/twiki/bin/view/Ps/OP/Logagent%25E8%25BF%2590%25E7%25BB%25B4%25E6%2589%258B%25E5%2586%258C][Logagent运维手册]]
