#+TITLE: Nsclick日志的PB化
#+DATE: 2014-04-28

* Diff
** Diff方案
** 单小时日志的单机Diff
#+BEGIN_SRC sh
[work@tc-dt-minos-master01.tc.baidu.com nsclick-diff]$ wc *
   3963406  113637660 3102306932 access_log.2014042819
    133618    3607287  109330585 hao123_access_log.2014042819
    346661    9780570  232520773 video_access_log.2014042819
   4443685  127025517 3444158290 total
#+END_SRC
   
下表是2014年4月28日19点的diff结果。
| Tag            |      PB |                     Text | Diff差值(PB-Text) | Diff比率(PB-Text) | 备注                    |
|----------------+---------+--------------------------+-------------------+-------------------+-------------------------|
| nsclick_hao123 |  201630 | 133618 + 68067  = 201685 |               -55 |            0.027% | pid=681不在PB日志中   |
| nsclick_video  |  346662 |                   346661 |                +1 |          0.00029% |                         |
| nsclick_music  |  445260 |                   445248 |               +12 |           0.0027% |                         |
| nsclick_ubs    |  385912 |                   385908 |                +4 |            0.001% |                         |
| nsclick_share  | 1427326 |                  1427313 |               +13 |          0.00091% |                         |
| nsclick_iknow  |  132828 |                   132825 |                +3 |           0.0023% |                         |
| nsclick_wenku  |  106790 |                   106791 |                -1 |          0.00094% | pid=112不在PB日志中   |
| nsclick_image  |    2244 |                     2235 |                +9 |              0.4% |                         |
| nsclick_news   |  137415 |                   137414 |                -1 |          0.00073% |                         |

说明：
*** nsclick_hao123文本日志包含两个pid
并且分布在pid=113部分分布在两个文件中。

*** nsclick_music文本日志包括了多个pid
#+BEGIN_SRC sh
grep -P "(pid=303&)|(pid=304&)|(pid=323&)|(pid=337&)|(pid=313&)|(pid=121&)|(pid=10000&)" access_log.2014042819 | wc
#+END_SRC

*** nsclick_ubs日志是按天切分的 
#+BEGIN_SRC sh
grep "2014:19" psups_access_log.20140428 | wc
#+END_SRC
